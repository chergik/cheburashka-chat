// Generated by CoffeeScript 1.9.0
(function() {
  'use strict';
  define(function(require) {
    var Backbone, Message, MessageView, MessagesListView, ebus, messagesListTemplate;
    Backbone = require('backbone');
    Message = require('models/message');
    MessageView = require('views/message');
    messagesListTemplate = require('templates/messages_list');
    ebus = require('lib/event_bus')();
    return MessagesListView = Backbone.View.extend({
      tagName: 'ul',
      id: 'messages_list',
      template: messagesListTemplate,
      initialize: function() {
        this.listenTo(this.collection, 'add', this.addOne);
        return ebus.on('message', (function(_this) {
          return function(data) {
            return _this.collection.add(new Message({
              user: data.user,
              message: data.message
            }));
          };
        })(this));
      },
      render: function() {
        var model, _i, _len, _ref;
        this.$el.html(this.template());
        _ref = this.collection;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          model = _ref[_i];
          this.addOne(model);
        }
        return this;
      },
      addOne: (function(_this) {
        return function(model) {
          var newMessage;
          newMessage = new MessageView({
            model: model
          });
          return _this.$el.append(newMessage.render().el);
        };
      })(this)
    });
  });

}).call(this);
